<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/*!
 * Ext Server
 * Copyright (c)2012 Xenophy.CO.,LTD All rights Reserved.
 * MIT Licensed
 */

<span id='Ext-util-Format'>/**
</span> * @class Ext.util.Format
 *
 * {Ext_util_Format:doc-contents}
 *
 * @singleton
 */
module.exports = {

    // {{{ currencyAtEnd

<span id='Ext-util-Format-property-currencyAtEnd'>    /**
</span>     * @property {Boolean} currencyAtEnd
     *
     * {Ext_util_Format:property-currencyAtEnd:desc}
     */
    currencyAtEnd: false,

    // }}}
    // {{{ currencyPrecision

<span id='Ext-util-Format-property-currencyPrecision'>    /**
</span>     * @property {Number} currencyPrecision
     *
     * {Ext_util_Format:property-currencyPrecision:desc}
     */
    currencyPrecision: 2,

    // }}}
    // {{{ currencySign

<span id='Ext-util-Format-property-currencySign'>    /**
</span>     * @property {String} currencySign
     *
     * {Ext_util_Format:property-currencySign:desc}
     */
    currencySign: '$',

    // }}}
    // {{{ decimalSeparator

<span id='Ext-util-Format-property-decimalSeparator'>    /**
</span>     * @property {String} decimalSeparator
     *
     * {Ext_util_Format:property-decimalSeparator:desc}
     */
    decimalSeparator: '.',

    // }}}
    // {{{ thousandSeparator

<span id='Ext-util-Format-property-thousandSeparator'>    /**
</span>     * @property {String} thousandSeparator
     *
     * {Ext_util_Format:property-thousandSeparator:desc}
     */
    thousandSeparator: ',',

    // }}}
    // {{{ capitalize

<span id='Ext-util-Format-method-capitalize'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    capitalize: Ext.String.capitalize,

    // }}}
    // {{{ currency

<span id='Ext-util-Format-method-currency'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    currency: function(v, currencySign, decimals, end) {

        var negativeSign = '',
            format = &quot;,0&quot;,
            i = 0;
            v = v - 0;

        if(v &lt; 0) {
            v = -v;
            negativeSign = '-';
        }

        decimals = decimals || Ext.util.Format.currencyPrecision;
        format += format + (decimals &gt; 0 ? '.' : '');

        for(; i &lt; decimals; i++) {
            format += '0';
        }

        v = Ext.util.Format.number(v, format);

        if((end || Ext.util.Format.currencyAtEnd) === true) {
            return Ext.String.format(&quot;{0}{1}{2}&quot;, negativeSign, v, currencySign || Ext.util.Format.currencySign);
        } else {
            return Ext.String.format(&quot;{0}{1}{2}&quot;, negativeSign, currencySign || Ext.util.Format.currencySign, v);
        }

    },

    // }}}
    // {{{ date

<span id='Ext-util-Format-method-date'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    date: function(v, format) {

        if(!v) {
            return &quot;&quot;;
        }

        if(!Ext.isDate(v)) {
            v = new Date(Date.parse(v));
        }

        return Ext.Date.dateFormat(v, format || Ext.Date.defaultFormat);

    },

    // }}}
    // {{{ dateRenderer

<span id='Ext-util-Format-method-dateRenderer'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    dateRenderer: function(format) {

        return function(v) {
            return Ext.util.Format.date(v, format);
        };

    },

    // }}}
    // {{{ defaultValue

<span id='Ext-util-Format-method-defaultValue'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    defaultValue: function(value, defaultValue) {
        return value !== undefined &amp;&amp; value !== '' ? value : defaultValue;
    },

    // }}}
    // {{{ ellipsis

<span id='Ext-util-Format-method-ellipsis'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    ellipsis: Ext.String.ellipsis,

    // }}}
    // {{{ escapeRegex

<span id='Ext-util-Format-method-escapeRegex'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    escapeRegex: function(s) {
        return s.replace(/([\-.*+?\^${}()|\[\]\/\\])/g, &quot;\\$1&quot;);
    },

    // }}}
    // {{{ fileSize

<span id='Ext-util-Format-method-fileSize'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    fileSize: function(size) {

        if(size &lt; 1024) {
            return size + &quot; bytes&quot;;
        } else if(size &lt; 1048576) {
            return (Math.round(((size*10) / 1024))/10) + &quot; KB&quot;;
        } else {
            return (Math.round(((size*10) / 1048576))/10) + &quot; MB&quot;;
        }

    },

    // }}}
    // {{{ format

<span id='Ext-util-Format-method-format'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    format: Ext.String.format,

    // }}}
    // {{{ htmlDecode

<span id='Ext-util-Format-method-htmlDecode'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    htmlDecode: Ext.String.htmlDecode,

    // }}}
    // {{{ htmlEncode

<span id='Ext-util-Format-method-htmlEncode'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    htmlEncode: Ext.String.htmlEncode,

    // }}}
    // {{{ jpMoney

<span id='Ext-util-Format-method-jpMoney'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    jpMoney: function(v) {
        return &quot;Â¥&quot; + this.numberFormat(v);
    },

    // }}}
    // {{{ leftPad

<span id='Ext-util-Format-method-leftPad'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    leftPad: Ext.String.leftPad,

    // }}}
    // {{{ lowercase

<span id='Ext-util-Format-method-lowercase'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    lowercase: function(value) {
        return String(value).toLowerCase();
    },

    // }}}
    // {{{ math

<span id='Ext-util-Format-method-math'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    math: function() {

        var fns = {};

        return function(v, a) {

            if(!fns[a]) {
                fns[a] = Ext.functionFactory('v', 'return v ' + a + ';');
            }

            return fns[a](v);
        };

    }(),

    // }}}
    // {{{ nl2br

<span id='Ext-util-Format-method-nl2br'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    nl2br: function(v) {
        var nl2brRe = /\r?\n/g;
        return Ext.isEmpty(v) ? '' : v.replace(nl2brRe, '&lt;br /&gt;');
    },

    // }}}
    // {{{ number

<span id='Ext-util-Format-method-number'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    number: function(v, formatString) {

        var I18NFormatCleanRe;
        var formatCleanRe = /[^\d\.]/g;

        if(!formatString) {
            return v;
        }

        v = Ext.Number.from(v, NaN);

        if(isNaN(v)) {
            return '';
        }

        var comma = Ext.util.Format.thousandSeparator,
        dec   = Ext.util.Format.decimalSeparator,
        i18n  = false,
        neg   = v &lt; 0,
        hasComma,
        psplit;

        v = Math.abs(v);

        if(formatString.substr(formatString.length - 2) == '/i') {

            if(!I18NFormatCleanRe) {

                I18NFormatCleanRe = new RegExp('[^\\d\\' + Ext.util.Format.decimalSeparator + ']','g');

            }

            formatString = formatString.substr(0, formatString.length - 2);
            i18n   = true;
            hasComma = formatString.indexOf(comma) != -1;
            psplit = formatString.replace(I18NFormatCleanRe, '').split(dec);

        } else {

            hasComma = formatString.indexOf(',') != -1;
            psplit = formatString.replace(formatCleanRe, '').split('.');

        }

        if(1 &lt; psplit.length) {

            v = v.toFixed(psplit[1].length);

        } else if(2 &lt; psplit.length) {

            /*
             Ext.Error.raise({
                 sourceClass: &quot;Ext.util.Format&quot;,
                 sourceMethod: &quot;number&quot;,
                 value: v,
                 formatString: formatString,
                 msg: &quot;Invalid number format, should have no more than 1 decimal&quot;
             });
             */

        } else {

            v = v.toFixed(0);

        }

        var fnum = v.toString();

        psplit = fnum.split('.');

        if(hasComma) {

            var cnum = psplit[0],
                parr = [],
                j    = cnum.length,
                m    = Math.floor(j / 3),
                n    = cnum.length % 3 || 3,
                i;

            for(i = 0; i &lt; j; i += n) {

                if(i !== 0) {
                    n = 3;
                }

                parr[parr.length] = cnum.substr(i, n);
                m -= 1;
            }

            fnum = parr.join(comma);

            if(psplit[1]) {
                fnum += dec + psplit[1];
            }

        } else {

            if(psplit[1]) {
                fnum = psplit[0] + dec + psplit[1];
            }

        }

        if(neg) {
            neg = fnum.replace(/[^1-9]/g, '') !== '';
        }

        return (neg ? '-' : '') + formatString.replace(/[\d,?\.?]+/, fnum);
    },

    // }}}
    // {{{ numberFormat

<span id='Ext-util-Format-method-numberFormat'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    numberFormat: function(v) {
        return v.toString().replace(/([0-9]+?)(?=(?:[0-9]{3})+$)/g, '$1,');
    },

    // }}}
    // {{{ numberRenderer

<span id='Ext-util-Format-method-numberRenderer'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    numberRenderer: function(format) {
        return function(v) {
            return Ext.util.Format.number(v, format);
        };
    },

    // }}}
    // {{{ parseBox

<span id='Ext-util-Format-method-parseBox'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    parseBox: function(box) {

        if(Ext.isNumber(box)) {
            box = box.toString();
        }

        var parts  = box.split(' '), ln = parts.length;

        if(ln == 1) {

            parts[1] = parts[2] = parts[3] = parts[0];

        } else if(ln == 2) {

            parts[2] = parts[0];
            parts[3] = parts[1];

        } else if(ln == 3) {

            parts[3] = parts[1];

        }

        return {
            top    : parseInt(parts[0], 10) || 0,
            right  : parseInt(parts[1], 10) || 0,
            bottom : parseInt(parts[2], 10) || 0,
            left   : parseInt(parts[3], 10) || 0
        };
    },

    // }}}
    // {{{ plural

<span id='Ext-util-Format-method-plural'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    plural: function(v, s, p) {
        return v +' ' + (v == 1 ? s : (p ? p : s+'s'));
    },

    // }}}
    // {{{ replace

<span id='Ext-util-Format-method-replace'>    /**
</span>     * @method replace
     *
     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    replace: Ext.String.replace,

    // }}}
    // {{{ round

<span id='Ext-util-Format-method-round'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    round: function(value, precision) {

        var result = Number(value);

        if(typeof precision == 'number') {
            precision = Math.pow(10, precision);
            result = Math.round(value * precision) / precision;
        }

        return result;
    },

    // }}}
    // {{{ stripScripts

<span id='Ext-util-Format-method-stripScripts'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    stripScripts: function(v) {
        var stripScriptsRe = /(?:&lt;script.*?&gt;)((\n|\r|.)*?)(?:&lt;\/script&gt;)/ig;
        return !v ? v : String(v).replace(stripScriptsRe, &quot;&quot;);
    },

    // }}}
    // {{{ stripTags

<span id='Ext-util-Format-method-stripTags'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    stripTags: function(v) {
        var stripTagsRE = /&lt;\/?[^&gt;]+&gt;/gi;
        return !v ? v : String(v).replace(stripTagsRE, &quot;&quot;);
    },

    // }}}
    // {{{ substr

<span id='Ext-util-Format-method-substr'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    substr: function(value, start, length) {
        return String(value).substr(start, length);
    },

    // }}}
    // {{{ trim

<span id='Ext-util-Format-method-trim'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    trim: Ext.String.trim,

    // }}}
    // {{{ undef

<span id='Ext-util-Format-method-undef'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    undef: function(value) {
        return value !== undefined ? value : &quot;&quot;;
    },

    // }}}
    // {{{ uppercase

<span id='Ext-util-Format-method-uppercase'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    uppercase: function(value) {
        return String(value).toUpperCase();
    },

    // }}}
    // {{{ usMoney

<span id='Ext-util-Format-method-usMoney'>    /**
</span>     * &quot;write it&quot;
     *
     * @param o {Object} xxx
     * @return {Object}
     */
    usMoney: function(v) {
        return NX.util.Format.currency(v, '$', 2);
    }

    // }}}

};

/*
 * Local variables:
 * tab-width: 4
 * c-basic-offset: 4
 * c-hanging-comment-ender-p: nil
 * End:
 */
</pre>
</body>
</html>
